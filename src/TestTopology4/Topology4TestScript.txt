// setup type of network
mock network medium

// test network is populated with 4 devices
expect Room Added Kitchen
expect Kitchen open Standby eOn
expect Kitchen open 
Sources begin
Source 0 Sneaky Music DS Playlist Playlist True True True 4c494e4e-0026-0f99-1111-ef000004013f Volume 4c494e4e-0026-0f99-1111-ef000004013f
Source 1 Sneaky Music DS Radio Radio True True True 4c494e4e-0026-0f99-1111-ef000004013f Volume 4c494e4e-0026-0f99-1111-ef000004013f
Source 3 Sneaky Music DS Songcast Receiver True True True 4c494e4e-0026-0f99-1111-ef000004013f Volume 4c494e4e-0026-0f99-1111-ef000004013f
Sources end
expect Sneaky Music DS open Source 0 Sneaky Music DS Playlist Playlist True True True 4c494e4e-0026-0f99-1111-ef000004013f Volume 4c494e4e-0026-0f99-1111-ef000004013f
expect Sneaky Music DS open 
Senders begin
Sender Sneaky Music DS
Senders end
expect Room Added Sitting Room
expect Sitting Room open Standby eOn
expect Sitting Room open 
Sources begin
Source 0 Klimax DSM Playlist Playlist True True True 4c494e4e-0026-0f99-1112-ef000004013f Volume 4c494e4e-0026-0f99-1112-ef000004013f
Source 1 Klimax DSM Radio Radio True True True 4c494e4e-0026-0f99-1112-ef000004013f Volume 4c494e4e-0026-0f99-1112-ef000004013f
Source 3 Klimax DSM Songcast Receiver True True True 4c494e4e-0026-0f99-1112-ef000004013f Volume 4c494e4e-0026-0f99-1112-ef000004013f
Source 5 Klimax DSM Analog1 Analog True True True 4c494e4e-0026-0f99-1112-ef000004013f Volume 4c494e4e-0026-0f99-1112-ef000004013f
Source 6 Klimax DSM Analog2 Analog True True True 4c494e4e-0026-0f99-1112-ef000004013f Volume 4c494e4e-0026-0f99-1112-ef000004013f
Source 7 Klimax DSM Phono Analog True True True 4c494e4e-0026-0f99-1112-ef000004013f Volume 4c494e4e-0026-0f99-1112-ef000004013f
Source 8 Klimax DSM SPDIF1 Digital True True True 4c494e4e-0026-0f99-1112-ef000004013f Volume 4c494e4e-0026-0f99-1112-ef000004013f
Source 9 Klimax DSM SPDIF2 Digital True True True 4c494e4e-0026-0f99-1112-ef000004013f Volume 4c494e4e-0026-0f99-1112-ef000004013f
Source 10 Klimax DSM TOSLINK1 Digital True True True 4c494e4e-0026-0f99-1112-ef000004013f Volume 4c494e4e-0026-0f99-1112-ef000004013f
Source 11 Klimax DSM TOSLINK2 Digital True True True 4c494e4e-0026-0f99-1112-ef000004013f Volume 4c494e4e-0026-0f99-1112-ef000004013f
Sources end
expect Klimax DSM open Source 0 Klimax DSM Playlist Playlist True True True 4c494e4e-0026-0f99-1112-ef000004013f Volume 4c494e4e-0026-0f99-1112-ef000004013f
expect Klimax DSM open 
Senders begin
Sender Klimax DSM
Senders end
expect Room Added Bedroom
expect Bedroom open Standby eOn
expect Bedroom open 
Sources begin
Source 0 Kiko DSM Playlist Playlist True True True 4c494e4e-0026-0f99-1113-ef000004013f Volume 4c494e4e-0026-0f99-1113-ef000004013f
Source 1 Kiko DSM Radio Radio True True True 4c494e4e-0026-0f99-1113-ef000004013f Volume 4c494e4e-0026-0f99-1113-ef000004013f
Source 3 Kiko DSM Songcast Receiver True True True 4c494e4e-0026-0f99-1113-ef000004013f Volume 4c494e4e-0026-0f99-1113-ef000004013f
Source 5 Kiko DSM Analog1 Analog True True True 4c494e4e-0026-0f99-1113-ef000004013f Volume 4c494e4e-0026-0f99-1113-ef000004013f
Source 6 Kiko DSM Analog2 Analog True True True 4c494e4e-0026-0f99-1113-ef000004013f Volume 4c494e4e-0026-0f99-1113-ef000004013f
Source 7 Kiko DSM Phono Analog True True True 4c494e4e-0026-0f99-1113-ef000004013f Volume 4c494e4e-0026-0f99-1113-ef000004013f
Source 8 Kiko DSM SPDIF1 Digital True True True 4c494e4e-0026-0f99-1113-ef000004013f Volume 4c494e4e-0026-0f99-1113-ef000004013f
Source 9 Kiko DSM SPDIF2 Digital True True True 4c494e4e-0026-0f99-1113-ef000004013f Volume 4c494e4e-0026-0f99-1113-ef000004013f
Source 10 Kiko DSM TOSLINK1 Digital True True True 4c494e4e-0026-0f99-1113-ef000004013f Volume 4c494e4e-0026-0f99-1113-ef000004013f
Source 11 Kiko DSM TOSLINK2 Digital True True True 4c494e4e-0026-0f99-1113-ef000004013f Volume 4c494e4e-0026-0f99-1113-ef000004013f
Sources end
expect Kiko DSM open Source 0 Kiko DSM Playlist Playlist True True True 4c494e4e-0026-0f99-1113-ef000004013f Volume 4c494e4e-0026-0f99-1113-ef000004013f
expect Kiko DSM open 
Senders begin
Sender Kiko DSM
Senders end
expect Room Added Dining Room
expect Dining Room open Standby eOn
expect Dining Room open 
Sources begin
Source 0 Majik DS Playlist Playlist True True True 4c494e4e-0026-0f99-1114-ef000004013f Volume 4c494e4e-0026-0f99-1114-ef000004013f
Source 1 Majik DS Radio Radio True True True 4c494e4e-0026-0f99-1114-ef000004013f Volume 4c494e4e-0026-0f99-1114-ef000004013f
Source 3 Majik DS Songcast Receiver True True True 4c494e4e-0026-0f99-1114-ef000004013f Volume 4c494e4e-0026-0f99-1114-ef000004013f
Sources end
expect Majik DS open Source 0 Majik DS Playlist Playlist True True True 4c494e4e-0026-0f99-1114-ef000004013f Volume 4c494e4e-0026-0f99-1114-ef000004013f
expect Majik DS open 
Senders begin
Sender Majik DS
Senders end
empty

// test sources are add when ds appears on the network
mock network add ds 67
expect Room Added Main Room
expect Main Room open Standby eOn
expect Main Room open 
Sources begin
Source 0 Mock DS Playlist Playlist True True True 67 Volume 67
Source 1 Mock DS Radio Radio True True True 67 Volume 67
Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
Sources end
expect Mock DS open Source 0 Mock DS Playlist Playlist True True True 67 Volume 67
expect Mock DS open 
Senders begin
Sender Mock DS
Senders end
empty

// test source are removed when ds disappears on the network
mock network remove ds 67
expect Room Removed Main Room
empty

// test changing standby state for a single product in a room
mock network add ds 67
expect Room Added Main Room
expect Main Room open Standby eOn
expect Main Room open 
Sources begin
Source 0 Mock DS Playlist Playlist True True True 67 Volume 67
Source 1 Mock DS Radio Radio True True True 67 Volume 67
Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
Sources end
expect Mock DS open Source 0 Mock DS Playlist Playlist True True True 67 Volume 67
expect Mock DS open 
Senders begin
Sender Mock DS
Senders end
empty
mock network update ds 67 product standby false
expect Main Room update Standby eOff
empty
mock network update ds 67 product standby true
expect Main Room update Standby eOn
empty

// test changing standby state for a two products in a room
mock network add ds 68
expect Mock DS open Source 0 Mock DS Playlist Playlist True True True 67 Volume 67
expect Mock DS open 
Senders begin
Sender Mock DS
Senders end
expect Mock DS open Source 0 Mock DS Playlist Playlist True True True 68 Volume 68
expect Mock DS open 
Senders begin
Sender Mock DS
Senders end
expect Main Room update 
Sources begin
Source 0 Mock DS Playlist Playlist True True True 67 Volume 67
Source 1 Mock DS Radio Radio True True True 67 Volume 67
Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
Source 0 Mock DS Playlist Playlist True True True 68 Volume 68
Source 1 Mock DS Radio Radio True True True 68 Volume 68
Source 3 Mock DS Songcast Receiver True True True 68 Volume 68
Sources end
empty
mock network update ds 67 product standby false
expect Main Room update Standby eMixed
empty
mock network update ds 68 product standby false
expect Main Room update Standby eOff
empty
mock network update ds 68 product standby true
expect Main Room update Standby eMixed
empty
mock network update ds 67 product standby true
expect Main Room update Standby eOn
empty

// test linking ds 68 to ds 67
mock network update ds 68 product name Test
expect Mock DS open Source 0 Mock DS Playlist Playlist True True True 67 Volume 67
expect Mock DS open 
Senders begin
Sender Mock DS
Senders end
expect Test open Source 0 Test Playlist Playlist True True True 68 Volume 68
expect Test open 
Senders begin
Sender Test
Senders end
expect Main Room update 
Sources begin
Source 0 Mock DS Playlist Playlist True True True 67 Volume 67
Source 1 Mock DS Radio Radio True True True 67 Volume 67
Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
Source 0 Test Playlist Playlist True True True 68 Volume 68
Source 1 Test Radio Radio True True True 68 Volume 68
Source 3 Test Songcast Receiver True True True 68 Volume 68
Sources end
empty
mock network update ds 67 product source 0 name Test
expect Mock DS open Source 0 Test Playlist Playlist True True True 68 Volume 67 68
expect Mock DS open 
Senders begin
Sender Mock DS
Sender Test
Senders end
expect Main Room update 
Sources begin
Source 0 Test Playlist Playlist True True True 68 Volume 67 68
Source 1 Test Radio Radio True True True 68 Volume 67 68
Source 3 Test Songcast Receiver True True True 68 Volume 67 68
Source 1 Mock DS Radio Radio True True True 67 Volume 67
Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
Sources end
empty

// test toggling Mock DS source visibility
mock network update ds 67 product source 0 visible false
expect Mock DS open Source 0 Test Playlist Playlist True True True 68 Volume 67 68
expect Mock DS open 
Senders begin
Sender Mock DS
Sender Test
Senders end
expect Main Room update 
Sources begin
Source 0 Test Playlist Playlist True True True 68 Volume 67 68
Source 1 Test Radio Radio True True True 68 Volume 67 68
Source 3 Test Songcast Receiver True True True 68 Volume 67 68
Source 1 Mock DS Radio Radio True True True 67 Volume 67
Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
Sources end
empty
mock network update ds 67 product source 0 visible true
expect Mock DS open Source 0 Test Playlist Playlist True True True 68 Volume 67 68
expect Mock DS open 
Senders begin
Sender Mock DS
Sender Test
Senders end
expect Main Room update 
Sources begin
Source 0 Test Playlist Playlist True True True 68 Volume 67 68
Source 1 Test Radio Radio True True True 68 Volume 67 68
Source 3 Test Songcast Receiver True True True 68 Volume 67 68
Source 1 Mock DS Radio Radio True True True 67 Volume 67
Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
Sources end
empty

// test toggling Test source visibility
mock network update ds 68 product source 1 visible false
expect Mock DS open Source 0 Test Playlist Playlist True True True 68 Volume 67 68
expect Mock DS open 
Senders begin
Sender Mock DS
Sender Test
Senders end
expect Main Room update 
Sources begin
Source 0 Test Playlist Playlist True True True 68 Volume 67 68
Source 3 Test Songcast Receiver True True True 68 Volume 67 68
Source 1 Mock DS Radio Radio True True True 67 Volume 67
Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
Sources end
empty
mock network update ds 68 product source 1 visible true
expect Mock DS open Source 0 Test Playlist Playlist True True True 68 Volume 67 68
expect Mock DS open 
Senders begin
Sender Mock DS
Sender Test
Senders end
expect Main Room update 
Sources begin
Source 0 Test Playlist Playlist True True True 68 Volume 67 68
Source 1 Test Radio Radio True True True 68 Volume 67 68
Source 3 Test Songcast Receiver True True True 68 Volume 67 68
Source 1 Mock DS Radio Radio True True True 67 Volume 67
Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
Sources end
empty

// change ds 68's selected source
mock network update ds 68 product sourceindex 1
expect Mock DS update Source 1 Test Radio Radio True True True 68 Volume 67 68
empty
mock network update ds 68 product sourceindex 2
expect Mock DS update Source 2 Test UPnP AV UpnpAv False True True 68 Volume 67 68
empty
mock network update ds 68 product sourceindex 3
expect Mock DS update Source 3 Test Songcast Receiver True True True 68 Volume 67 68
empty

// change ds 67's selected source
mock network update ds 67 product sourceindex 1
expect Mock DS update Source 1 Mock DS Radio Radio True True True 67 Volume 67
empty
mock network update ds 67 product sourceindex 2
expect Mock DS update Source 2 Mock DS UPnP AV UpnpAv False True True 67 Volume 67
empty
mock network update ds 67 product sourceindex 3
expect Mock DS update Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
empty

// test current source is not updated when changing ds 68's source index when ds 67's source index has not been expanded by ds 68's sources
mock network update ds 68 product sourceindex 0
empty

// test breaking link by changing ds 68's name
mock network update ds 68 product name My DS
expect Mock DS open Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
expect Mock DS open 
Senders begin
Sender Mock DS
Senders end
expect My DS open Source 0 My DS Playlist Playlist True True True 68 Volume 68
expect My DS open 
Senders begin
Sender My DS
Senders end
expect Main Room update 
Sources begin
Source 0 Mock DS Test Playlist True True True 67 Volume 67
Source 1 Mock DS Radio Radio True True True 67 Volume 67
Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
Source 0 My DS Playlist Playlist True True True 68 Volume 68
Source 1 My DS Radio Radio True True True 68 Volume 68
Source 3 My DS Songcast Receiver True True True 68 Volume 68
Sources end
empty

// test reforming the link by changing ds 68's name - note that the Current source of the root is not updated
// because this change causes there to be 1 root (ds 67) and its source index is not expanded
mock network update ds 68 product name Test
expect Mock DS open Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
expect Mock DS open 
Senders begin
Sender Mock DS
Sender Test
Senders end
expect Main Room update 
Sources begin
Source 0 Test Playlist Playlist True True True 68 Volume 67 68
Source 1 Test Radio Radio True True True 68 Volume 67 68
Source 3 Test Songcast Receiver True True True 68 Volume 67 68
Source 1 Mock DS Radio Radio True True True 67 Volume 67
Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
Sources end
empty

// test breaking the link by changing ds 67's source name
mock network update ds 67 product source 0 name Playlist
expect Mock DS open Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
expect Mock DS open 
Senders begin
Sender Mock DS
Senders end
expect Test open Source 0 Test Playlist Playlist True True True 68 Volume 68
expect Test open 
Senders begin
Sender Test
Senders end
expect Main Room update 
Sources begin
Source 0 Mock DS Playlist Playlist True True True 67 Volume 67
Source 1 Mock DS Radio Radio True True True 67 Volume 67
Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
Source 0 Test Playlist Playlist True True True 68 Volume 68
Source 1 Test Radio Radio True True True 68 Volume 68
Source 3 Test Songcast Receiver True True True 68 Volume 68
Sources end
empty

// reform link of 67 and 68
mock network update ds 67 product source 0 name Test
expect Mock DS open Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
expect Mock DS open 
Senders begin
Sender Mock DS
Sender Test
Senders end
expect Main Room update 
Sources begin
Source 0 Test Playlist Playlist True True True 68 Volume 67 68
Source 1 Test Radio Radio True True True 68 Volume 67 68
Source 3 Test Songcast Receiver True True True 68 Volume 67 68
Source 1 Mock DS Radio Radio True True True 67 Volume 67
Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
Sources end
empty

mock network remove ds 67
expect Test open Source 0 Test Playlist Playlist True True True 68 Volume 68
expect Test open 
Senders begin
Sender Test
Senders end
expect Main Room update 
Sources begin
Source 0 Test Playlist Playlist True True True 68 Volume 68
Source 1 Test Radio Radio True True True 68 Volume 68
Source 3 Test Songcast Receiver True True True 68 Volume 68
Sources end
empty

// remove Time service for 67
mock network update ds 67 product attributes Info Volume Sender
empty

mock network add ds 67
expect Mock DS open Source 3 Mock DS Songcast Receiver True True False 67 Volume 67
expect Mock DS open 
Senders begin
Sender Mock DS
Sender Test
Senders end
expect Main Room update 
Sources begin
Source 0 Test Playlist Playlist True True True 68 Volume 67 68
Source 1 Test Radio Radio True True True 68 Volume 67 68
Source 3 Test Songcast Receiver True True True 68 Volume 67 68
Source 1 Mock DS Radio Radio True True False 67 Volume 67
Source 3 Mock DS Songcast Receiver True True False 67 Volume 67
Sources end
empty

mock network remove ds 67
expect Test open Source 0 Test Playlist Playlist True True True 68 Volume 68
expect Test open 
Senders begin
Sender Test
Senders end
expect Main Room update 
Sources begin
Source 0 Test Playlist Playlist True True True 68 Volume 68
Source 1 Test Radio Radio True True True 68 Volume 68
Source 3 Test Songcast Receiver True True True 68 Volume 68
Sources end
empty

// remove Info service from 67
mock network update ds 67 product attributes Volume Sender
empty

mock network add ds 67
expect Mock DS open Source 3 Mock DS Songcast Receiver True False False 67 Volume 67
expect Mock DS open 
Senders begin
Sender Mock DS
Sender Test
Senders end
expect Main Room update 
Sources begin
Source 0 Test Playlist Playlist True True True 68 Volume 67 68
Source 1 Test Radio Radio True True True 68 Volume 67 68
Source 3 Test Songcast Receiver True True True 68 Volume 67 68
Source 1 Mock DS Radio Radio True False False 67 Volume 67
Source 3 Mock DS Songcast Receiver True False False 67 Volume 67
Sources end
empty

mock network remove ds 67
expect Test open Source 0 Test Playlist Playlist True True True 68 Volume 68
expect Test open 
Senders begin
Sender Test
Senders end
expect Main Room update 
Sources begin
Source 0 Test Playlist Playlist True True True 68 Volume 68
Source 1 Test Radio Radio True True True 68 Volume 68
Source 3 Test Songcast Receiver True True True 68 Volume 68
Sources end
empty

// re-add Info and Time services and remove Volume service from 67
mock network update ds 67 product attributes Info Time Sender
empty

mock network add ds 67
expect Mock DS open Source 3 Mock DS Songcast Receiver True True True 67 Volume
expect Mock DS open 
Senders begin
Sender Mock DS
Sender Test
Senders end
expect Main Room update 
Sources begin
Source 0 Test Playlist Playlist True True True 68 Volume 68
Source 1 Test Radio Radio True True True 68 Volume 68
Source 3 Test Songcast Receiver True True True 68 Volume 68
Source 1 Mock DS Radio Radio True True True 67 Volume
Source 3 Mock DS Songcast Receiver True True True 67 Volume
Sources end
empty

mock network remove ds 68
expect Mock DS open Source 3 Mock DS Songcast Receiver True True True 67 Volume
expect Mock DS open 
Senders begin
Sender Mock DS
Senders end
expect Main Room update 
Sources begin
Source 0 Mock DS Test Playlist True True True 67 Volume
Source 1 Mock DS Radio Radio True True True 67 Volume
Source 3 Mock DS Songcast Receiver True True True 67 Volume
Sources end
empty

// remove Volume service from 68
mock network update ds 68 product attributes Info Time Sender
empty

mock network add ds 68
expect Mock DS open Source 3 Mock DS Songcast Receiver True True True 67 Volume
expect Mock DS open 
Senders begin
Sender Mock DS
Sender Test
Senders end
expect Main Room update 
Sources begin
Source 0 Test Playlist Playlist True True True 68 Volume
Source 1 Test Radio Radio True True True 68 Volume
Source 3 Test Songcast Receiver True True True 68 Volume
Source 1 Mock DS Radio Radio True True True 67 Volume
Source 3 Mock DS Songcast Receiver True True True 67 Volume
Sources end
empty

mock network remove ds 67
expect Test open Source 0 Test Playlist Playlist True True True 68 Volume
expect Test open 
Senders begin
Sender Test
Senders end
expect Main Room update 
Sources begin
Source 0 Test Playlist Playlist True True True 68 Volume
Source 1 Test Radio Radio True True True 68 Volume
Source 3 Test Songcast Receiver True True True 68 Volume
Sources end
empty

// add Volume service to 67
mock network update ds 67 product attributes Info Time Volume Sender
empty

mock network add ds 67
expect Mock DS open Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
expect Mock DS open 
Senders begin
Sender Mock DS
Sender Test
Senders end
expect Main Room update 
Sources begin
Source 0 Test Playlist Playlist True True True 68 Volume 67
Source 1 Test Radio Radio True True True 68 Volume 67
Source 3 Test Songcast Receiver True True True 68 Volume 67
Source 1 Mock DS Radio Radio True True True 67 Volume 67
Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
Sources end
empty

mock network remove ds 68
expect Mock DS open Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
expect Mock DS open 
Senders begin
Sender Mock DS
Senders end
expect Main Room update 
Sources begin
Source 0 Mock DS Test Playlist True True True 67 Volume 67
Source 1 Mock DS Radio Radio True True True 67 Volume 67
Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
Sources end
empty

// add Volume service to 68
mock network update ds 68 product attributes Info Time Volume Sender
empty

mock network add ds 68
expect Mock DS open Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
expect Mock DS open 
Senders begin
Sender Mock DS
Sender Test
Senders end
expect Main Room update 
Sources begin
Source 0 Test Playlist Playlist True True True 68 Volume 67 68
Source 1 Test Radio Radio True True True 68 Volume 67 68
Source 3 Test Songcast Receiver True True True 68 Volume 67 68
Source 1 Mock DS Radio Radio True True True 67 Volume 67
Source 3 Mock DS Songcast Receiver True True True 67 Volume 67
Sources end
empty

// disable sender on 68
mock network update ds 68 sender status Disabled
expect Mock DS update 
Senders begin
Sender Mock DS
Senders end
empty

// enable sender on 68
mock network update ds 68 sender status Enabled
expect Mock DS update 
Senders begin
Sender Mock DS
Sender Test
Senders end
empty
